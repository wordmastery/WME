<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8">
  <title>EasySpeakUp â€“ Dialogue Preview</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-amber-50 via-rose-50 to-indigo-50 min-h-screen">
  <div class="max-w-4xl mx-auto p-4 md:p-6 lg:p-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-amber-500 via-rose-500 to-indigo-600 bg-clip-text text-transparent mb-2 drop-shadow">
        ğŸ™ï¸ Dialogue Voice Preview
      </h1>
      <p class="text-gray-700 font-semibold text-base md:text-lg">
        Aarav: line â†’ Sara: line | System voice only (no download)
      </p>
      <div class="mt-3 bg-gradient-to-r from-emerald-100 to-green-100 p-3 rounded-2xl text-xs font-bold text-emerald-800 shadow">
        100% Free â€¢ No API â€¢ Speed + pitch + realistic gap
      </div>
    </div>
    
    <!-- Script input -->
    <div class="bg-white/80 p-6 rounded-3xl shadow-xl border border-white/60 mb-6 backdrop-blur-sm hover:shadow-2xl hover:-translate-y-0.5 transition">
      <label class="block text-xl font-bold text-center mb-3">
        Dialogue Script (Aarav: / Sara: format)
      </label>
      <textarea id="script" rows="8" class="w-full p-4 border-2 border-gray-200 rounded-2xl text-base md:text-lg min-h-[220px] md:min-h-[260px]">
Aarav: Hi, excuse meâ€¦ is this seat taken?
Sara: Oh no, you can sit here.
Aarav: Thank you so much.
Sara: Youâ€™re welcome!
Aarav: Whatâ€™s your name?
Sara: Iâ€™m Sara, nice to meet you!</textarea>
    </div>
    
    <!-- Voice selects -->
    <div class="grid md:grid-cols-2 gap-4 mb-4">
      <div class="bg-blue-50/90 p-4 rounded-2xl shadow-xl border border-white/60 backdrop-blur-sm hover:shadow-2xl hover:-translate-y-0.5 transition">
        <h3 class="font-bold mb-2 flex items-center text-blue-800">
          <span class="mr-2 text-2xl">ğŸ‘¨</span> Aarav (Male voice)
        </h3>
        <select id="maleVoice" class="w-full border rounded-lg p-2 text-sm"></select>
      </div>
      <div class="bg-pink-50/90 p-4 rounded-2xl shadow-xl border border-white/60 backdrop-blur-sm hover:shadow-2xl hover:-translate-y-0.5 transition">
        <h3 class="font-bold mb-2 flex items-center text-pink-800">
          <span class="mr-2 text-2xl">ğŸ‘©</span> Sara (Female voice)
        </h3>
        <select id="femaleVoice" class="w-full border rounded-lg p-2 text-sm"></select>
      </div>
    </div>
    
    <!-- Speaker mode -->
    <div class="bg-white/80 p-3 rounded-2xl shadow-xl border border-white/60 mb-4 flex flex-wrap gap-3 items-center backdrop-blur-sm">
      <span class="font-semibold text-sm">Who should speak?</span>
      <select id="mode" class="border rounded-lg p-2 text-sm">
        <option value="both">Aarav + Sara (dialogue)</option>
        <option value="aarav">Only Aarav (single male)</option>
        <option value="sara">Only Sara (single female)</option>
      </select>
    </div>
    
    <!-- Speed controls -->
    <div class="bg-white/80 p-3 rounded-2xl shadow-xl border border-white/60 mb-6 flex flex-wrap gap-2 items-center justify-center backdrop-blur-sm">
      <span class="font-semibold text-sm mr-2">Speed:</span>
      <button class="speed px-3 py-1 rounded-full bg-slate-200 text-xs" data-rate="0.6">Extra slow</button>
      <button class="speed px-3 py-1 rounded-full bg-slate-200 text-xs" data-rate="0.85">Slow</button>
      <button class="speed px-3 py-1 rounded-full bg-indigo-600 text-white text-xs" data-rate="1">Normal</button>
      <button class="speed px-3 py-1 rounded-full bg-slate-200 text-xs" data-rate="1.15">Fast</button>
    </div>
    
    <!-- Button -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
      <button id="previewBtn" class="w-full sm:flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-3xl font-bold text-lg shadow-xl hover:shadow-2xl hover:-translate-y-0.5 transition">
        â–¶ï¸ Preview Dialogue
      </button>
    </div>
    
    <!-- Preview -->
    <div id="previewBox" class="hidden bg-white/90 p-4 rounded-3xl shadow-xl border border-white/60 mb-4 backdrop-blur-sm">
      <h3 class="font-bold text-emerald-800 mb-3 text-center text-lg">ğŸ¬ Live Preview</h3>
      <div id="lines" class="space-y-2 text-base"></div>
    </div>
    
    <!-- Status -->
    <div id="status" class="hidden text-center p-3 rounded-3xl text-xs font-mono mb-4"></div>
  </div>
  
  <script>
    const scriptBox = document.getElementById('script');
    const maleSelect = document.getElementById('maleVoice');
    const femaleSelect = document.getElementById('femaleVoice');
    const modeSelect = document.getElementById('mode');
    const previewBtn = document.getElementById('previewBtn');
    const statusBox = document.getElementById('status');
    const previewBox = document.getElementById('previewBox');
    const linesBox = document.getElementById('lines');
    
    let currentRate = 1;
    
    function showStatus(msg, type) {
      const base = 'text-center p-3 rounded-3xl text-xs font-mono mb-4 ';
      if (type === 'error') statusBox.className = base + 'bg-red-100 text-red-800';
      else if (type === 'ok') statusBox.className = base + 'bg-emerald-100 text-emerald-800';
      else statusBox.className = base + 'bg-blue-100 text-blue-800';
      statusBox.textContent = msg;
      statusBox.classList.remove('hidden');
    }
    
    // Speed buttons
    document.querySelectorAll('.speed').forEach(btn => {
      btn.addEventListener('click', () => {
        currentRate = parseFloat(btn.dataset.rate);
        document.querySelectorAll('.speed').forEach(b => {
          b.classList.remove('bg-indigo-600', 'text-white');
          b.classList.add('bg-slate-200', 'text-black');
        });
        btn.classList.add('bg-indigo-600', 'text-white');
        btn.classList.remove('bg-slate-200', 'text-black');
      });
    });
    
    // Load system voices
    function loadVoices() {
      const voices = window.speechSynthesis.getVoices();
      maleSelect.innerHTML = '';
      femaleSelect.innerHTML = '';
      voices.forEach(v => {
        const o1 = document.createElement('option');
        o1.value = v.name;
        o1.textContent = v.name + ' (' + v.lang + ')';
        maleSelect.appendChild(o1);
        const o2 = document.createElement('option');
        o2.value = v.name;
        o2.textContent = v.name + ' (' + v.lang + ')';
        femaleSelect.appendChild(o2);
      });
      const mDef = [...maleSelect.options].find(o => o.text.includes('en-IN') || o.text.includes('hi-IN')) || maleSelect.options[0];
      if (mDef) maleSelect.value = mDef.value;
      const fDef = [...femaleSelect.options].find(o =>
        o.text.toLowerCase().includes('female') && (o.text.includes('en-IN') || o.text.includes('hi-IN'))
      ) || femaleSelect.options[0];
      if (fDef) femaleSelect.value = fDef.value;
    }
    
    if ('speechSynthesis' in window) {
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    } else {
      showStatus('Browser speech support nahi karta (Chrome/Edge use karo).', 'error');
    }
    
    function parseDialogue(text) {
      const mode = modeSelect.value;
      const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
      const out = [];
      lines.forEach(line => {
        const idx = line.indexOf(':');
        if (idx === -1) return;
        const name = line.slice(0, idx).trim().toLowerCase();
        const sentence = line.slice(idx + 1).trim();
        if (!sentence) return;
        let isMale = name.includes('aarav');
        if (mode === 'aarav' && !isMale) return;
        if (mode === 'sara' && isMale) return;
        if (mode === 'aarav') isMale = true;
        if (mode === 'sara') isMale = false;
        out.push({ text: sentence, isMale });
      });
      return out;
    }
    
    function speakLine(text, isMale) {
      return new Promise(resolve => {
        const u = new SpeechSynthesisUtterance(text);
        const voices = window.speechSynthesis.getVoices();
        const name = isMale ? maleSelect.value : femaleSelect.value;
        const v = voices.find(v => v.name === name);
        if (v) u.voice = v;
        
        // Refined natural settings
        u.rate = isMale ? currentRate * 0.9 : currentRate * 1.05;
        u.pitch = isMale ? 0.8 : 1.35;
        u.volume = 1.0;
        
        u.onend = () => resolve();
        window.speechSynthesis.speak(u);
      });
    }
    
    async function previewDialogue() {
      const parts = parseDialogue(scriptBox.value);
      if (!parts.length) {
        showStatus('Format: Aarav: line / Sara: line', 'error');
        return;
      }
      window.speechSynthesis.cancel();
      previewBox.classList.remove('hidden');
      linesBox.innerHTML = '';
      showStatus('Preview chal raha haiâ€¦', 'info');
      
      let prevIsMale = null;
      
      for (const p of parts) {
        const row = document.createElement('div');
        row.className =
          'px-3 py-2 md:px-4 md:py-3 rounded-2xl text-sm md:text-base text-white shadow ' +
          (p.isMale ?
            'bg-gradient-to-r from-blue-500 to-indigo-500' :
            'bg-gradient-to-r from-pink-500 to-rose-500');
        row.textContent = p.text;
        linesBox.appendChild(row);
        
        await speakLine(p.text, p.isMale);
        
        let pauseMs;
        if (prevIsMale === null) {
          pauseMs = 500; // first line
        } else if (prevIsMale === p.isMale) {
          pauseMs = 350; // same speaker continue
        } else {
          pauseMs = 900; // speaker change
        }
        prevIsMale = p.isMale;
        await new Promise(r => setTimeout(r, pauseMs));
      }
      
      showStatus('Preview complete. Ab speed, mode ya script badal kar fir se sun sakte ho.', 'ok');
    }
    
    previewBtn.addEventListener('click', previewDialogue);
  </script>
</body>

</html>